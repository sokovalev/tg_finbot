1. Архитектурная декомпозиция (System Design)
   Вместо жестких скриптов (if text == "еда") мы строим систему на основе Intent Recognition (распознавание намерений).

Модуль А: Входящий шлюз (Input Processing)
Text Sanitizer: Очистка сообщения от эмодзи, лишних пробелов.

LLM Parser (The Brain): Промпт-инженерная задача. Модель должна получать сырой текст и возвращать JSON.

Вход: "пиво в баре за 300"

Выход: {"amount": 300, "currency": "RUB", "category": "Развлечения", "subcategory": "Алкоголь/Бары", "date": "today", "comment": "пиво в баре"}

Voice Transcriber (STT): Преобразование голоса в текст (Whisper API или аналоги) перед отправкой в LLM Parser.

Модуль Б: База Данных и Логика
Transaction Ledger: Хранение транзакций. Важно: хранить не только категорию, но и сырой текст пользователя, чтобы потом можно было переобучать модель или уточнять детали.

Category Manager: Динамические категории. Если пользователь пишет "корм для хомяка", LLM должна понять, создать ли новую категорию или отнести к "Питомцы".

Context Engine: Память бота. Если пользователь пишет "еще 200 на то же самое", бот должен помнить предыдущее сообщение.

Модуль В: Аналитика и Reporting
Query Builder: Преобразование запроса на естественном языке ("сколько я пропил в прошлом месяце?") в SQL/NoSQL запрос к базе.

Insight Generator: Генерация текстового ответа на основе данных ("Ты потратил 5000 на алкоголь, это на 20% больше, чем в прошлом месяце. Может, стоит притормозить?").

2. Пользовательские сценарии (User Stories)
   Мы пойдем дальше простого "записал - сохранил".

Сценарий 1: "Мульти-транзакция" (Smart Input)
Пользователь: "Купил продукты на 1500, такси до дома 300 и еще закинул 500 на телефон"

Система: LLM разбивает одно сообщение на три отдельные транзакции.

Бот:

✅ Записано:
— Продукты: 1500 ₽
— Транспорт (Такси): 300 ₽
— Связь: 500 ₽
Все верно?

Сценарий 2: "Умная аналитика" (Contextual Query)
Пользователь: "Сколько я трачу на кофе?"

Система: Ищет не только категорию "Кофе", но и ключевые слова "латте", "капучино", "Старбакс" в описаниях транзакций.

Бот: "В среднем ты тратишь 4500 ₽ в месяц. Чаще всего ты берешь кофе по вторникам утром".

Сценарий 3: "Корректировка задним числом"
Пользователь: "Блин, те 5000 это был не ресторан, а долг вернул"

Система: Находит последнюю транзакцию на 5000 и меняет категорию с "Еда" на "Долги/Переводы".

Бот: "Понял, перенес 5000 в категорию 'Возврат долга'. В расходах теперь не учитывается".

3. Недостающие фичи (Латеральное мышление)
   Чтобы бот стал "вирусным" и полезным, добавим функционал, который обычно упускают:

Семейный бюджет (Multi-user mode): Возможность добавить "партнера" в чат или связать аккаунты. Бот видит траты обоих и считает общий баланс. "Маша купила продукты" — списывается с общего бюджета.

Детектор регулярных платежей: Если пользователь 3-го числа каждого месяца вводит "Интернет 500", бот на 3-й раз спрашивает: "Это регулярный платеж? Напоминать о нем?"

Валютный конвертер на лету: Пользователь в отпуске пишет: "Ужин 40 евро". Бот автоматически конвертирует в основную валюту пользователя по текущему курсу ЦБ, но сохраняет и оригинал.

Эмоциональный теггинг (Психология трат): (Опционально) Бот может спрашивать после крупных трат: "Как ощущения от покупки?". Это позволит потом строить отчет: "На что я трачу и жалею?" vs "На что трачу и счастлив?".

4. Монетизация: Бесплатная vs Платная версия
   Разделение должно строиться на стоимости ресурсов (LLM токены, STT) и ценности для "продвинутых" пользователей.​

Фича Free Tier (Бесплатно) Pro Tier (Подписка)
Ввод данных Только текст Голосовые сообщения (Главный драйвер продаж), Фото чеков (OCR)
Модель ИИ Базовая (быстрая, дешевая, напр. GPT-4o-mini / Haiku) Продвинутая (глубокий контекст, напр. GPT-4o / Claude 3.5 Sonnet)
История и отчеты Стандартные (день, неделя, месяц). Хранение 1 год. Произвольные запросы ("сравни этот март с прошлым"), экспорт в Excel/CSV. Безлимитное хранение.
Категории Автоматические (стандартный набор) Пользовательские правила (научить бота, что "Ашан" — это "Бытовая химия", а не "Еда")
Бюджетирование Нет Установка лимитов, алерты о перерасходе, "Семейный доступ" 5. Технический стек (Рекомендация)
Для быстрой реализации MVP:

Язык: Python.

Фреймворк: aiogram (асинхронный, лучший для Telegram).​

LLM Orchestration: LangChain или LiteLLM (чтобы легко переключать модели между OpenAI, Anthropic, DeepSeek).

База данных: PostgreSQL (для надежности транзакций) + Redis (для кэширования контекста диалога).

Деплой: Docker контейнер на VPS.
