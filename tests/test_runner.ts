import fs from "fs";
import pLimit from "p-limit";
import cliProgress from "cli-progress";
import { LLMCategorizeExpense } from "../src/services/LLMCategorization/LLMCategorization";

const TEST_CASES = [
  // --- –ï–î–ê –ò –ü–†–û–î–£–ö–¢–´ ---
  { input: "–ú–æ–ª–æ–∫–æ –∏ —Ö–ª–µ–± 120", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 120 },
  { input: "–ü—è—Ç–µ—Ä–æ—á–∫–∞ –ø—Ä–æ–¥—É–∫—Ç—ã 1500", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 1500 },
  { input: "–í–∫—É—Å–í–∏–ª–ª 450", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 450 },
  { input: "–ú—è—Å–æ –¥–ª—è —à–∞—à–ª—ã–∫–∞ 2000", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 2000 },
  { input: "–ö–æ—Ñ–µ —Å —Å–æ–±–æ–π 200", expected: "–ö–∞—Ñ–µ –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã", amount: 200 },
  { input: "–ë–∏–∑–Ω–µ—Å –ª–∞–Ω—á 450", expected: "–ö–∞—Ñ–µ –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã", amount: 450 },
  { input: "–®–∞—É—Ä–º–∞ 250", expected: "–ö–∞—Ñ–µ –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã", amount: 250 },
  { input: "–ú–∞–∫–¥–æ–Ω–∞–ª—å–¥—Å 600", expected: "–ö–∞—Ñ–µ –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã", amount: 600 },
  { input: "–ú–æ—Ä–æ–∂–µ–Ω–æ–µ –≤ –ø–∞—Ä–∫–µ 150", expected: "–ö–∞—Ñ–µ –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã", amount: 150 }, // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ–∂–∏–¥–∞–Ω–∏–µ
  { input: "–°—Ç–æ–ª–æ–≤–∞—è –æ–±–µ–¥ 300", expected: "–ö–∞—Ñ–µ –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã", amount: 300 },
  { input: "–Ø–Ω–¥–µ–∫—Å –µ–¥–∞ –ø–∏—Ü—Ü–∞ 1200", expected: "–î–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã", amount: 1200 },
  { input: "–î–µ–ª–∏–≤–µ—Ä–∏ –∫–ª–∞–± 800", expected: "–î–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã", amount: 800 },
  { input: "–°—É—à–∏ —Å–µ—Ç –¥–æ–º–æ–π 2100", expected: "–î–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã", amount: 2100 },
  { input: "–ö—É—Ä—å–µ—Ä –°–∞–º–æ–∫–∞—Ç 500", expected: "–î–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã", amount: 500 },

  // --- –ê–í–¢–û –ò –¢–†–ê–ù–°–ü–û–†–¢ ---
  { input: "–¢–∞–∫—Å–∏ —è–Ω–¥–µ–∫—Å 456", expected: "–¢–∞–∫—Å–∏/–ö–∞—Ä—à–µ—Ä–∏–Ω–≥", amount: 456 },
  { input: "Uber –¥–æ —Ä–∞–±–æ—Ç—ã 300", expected: "–¢–∞–∫—Å–∏/–ö–∞—Ä—à–µ—Ä–∏–Ω–≥", amount: 300 },
  { input: "–°–∏—Ç–∏–¥—Ä–∞–π–≤ 500", expected: "–¢–∞–∫—Å–∏/–ö–∞—Ä—à–µ—Ä–∏–Ω–≥", amount: 500 },
  { input: "–î–µ–ª–∏–º–æ–±–∏–ª—å 340.50", expected: "–¢–∞–∫—Å–∏/–ö–∞—Ä—à–µ—Ä–∏–Ω–≥", amount: 340.5 },
  { input: "–ú–∞—Ä—à—Ä—É—Ç–∫–∞ 50", expected: "–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç", amount: 50 }, // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
  {
    input: "–ú–µ—Ç—Ä–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ 500",
    expected: "–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç",
    amount: 500,
  },
  { input: "–¢—Ä–æ–π–∫–∞ 1000—Ä", expected: "–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç", amount: 1000 },
  {
    input: "–ë–∏–ª–µ—Ç –Ω–∞ –∞–≤—Ç–æ–±—É—Å 65",
    expected: "–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç",
    amount: 65,
  }, // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
  { input: "–≠–ª–µ–∫—Ç—Ä–∏—á–∫–∞ 120", expected: "–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç", amount: 120 }, // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
  {
    input: "–ê—ç—Ä–æ—ç–∫—Å–ø—Ä–µ—Å—Å 500",
    expected: "–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç",
    amount: 500,
  }, // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
  { input: "–ë–µ–Ω–∑–∏–Ω 95 2000", expected: "–ê–≤—Ç–æ–º–æ–±–∏–ª—å: –¢–æ–ø–ª–∏–≤–æ", amount: 2000 },
  { input: "–õ—É–∫–æ–π–ª 3000", expected: "–ê–≤—Ç–æ–º–æ–±–∏–ª—å: –¢–æ–ø–ª–∏–≤–æ", amount: 3000 },
  { input: "–ì–∞–∑ –Ω–∞ –∞–≤—Ç–æ 800", expected: "–ê–≤—Ç–æ–º–æ–±–∏–ª—å: –¢–æ–ø–ª–∏–≤–æ", amount: 800 },
  {
    input: "–ú–æ–π–∫–∞ –º–∞—à–∏–Ω—ã 900",
    expected: "–ê–≤—Ç–æ–º–æ–±–∏–ª—å: –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ",
    amount: 900,
  },
  {
    input: "–ù–µ–∑–∞–º–µ—Ä–∑–∞–π–∫–∞ 200",
    expected: "–ê–≤—Ç–æ–º–æ–±–∏–ª—å: –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ",
    amount: 200,
  },
  {
    input: "–®–∏–Ω–æ–º–æ–Ω—Ç–∞–∂ 2500",
    expected: "–ê–≤—Ç–æ–º–æ–±–∏–ª—å: –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ",
    amount: 2500,
  },
  {
    input: "–ó–∞–º–µ–Ω–∞ –º–∞—Å–ª–∞ 6000",
    expected: "–ê–≤—Ç–æ–º–æ–±–∏–ª—å: –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ",
    amount: 6000,
  },
  {
    input: "–ü–ª–∞—Ç–Ω–∞—è –ø–∞—Ä–∫–æ–≤–∫–∞ 300",
    expected: "–ê–≤—Ç–æ–º–æ–±–∏–ª—å: –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ",
    amount: 300,
  },
  { input: "–®—Ç—Ä–∞—Ñ –ì–ò–ë–î–î 250", expected: "–ù–∞–ª–æ–≥–∏ –∏ —à—Ç—Ä–∞—Ñ—ã", amount: 250 }, // –ò–ª–∏ –∞–≤—Ç–æ, –Ω–æ –ø–æ –ø—Ä–æ–º–ø—Ç—É —à—Ç—Ä–∞—Ñ—ã -> –Ω–∞–ª–æ–≥–∏
  { input: "–û–°–ê–ì–û 8500", expected: "–ê–≤—Ç–æ–º–æ–±–∏–ª—å: –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ", amount: 8500 }, // –ü–æ –ø—Ä–æ–º–ø—Ç—É –Ω–∞–ø—Ä–∞–≤–∏–ª–∏ —Å—é–¥–∞

  // --- –î–û–ú, –†–ï–ú–û–ù–¢, –í–ï–©–ò ---
  { input: "–ü–æ—Ä–æ—à–æ–∫ —Å—Ç–∏—Ä–∞–ª—å–Ω—ã–π 600", expected: "–¢–æ–≤–∞—Ä—ã –¥–ª—è –¥–æ–º–∞", amount: 600 },
  { input: "–¢—É–∞–ª–µ—Ç–Ω–∞—è –±—É–º–∞–≥–∞ 200", expected: "–¢–æ–≤–∞—Ä—ã –¥–ª—è –¥–æ–º–∞", amount: 200 },
  { input: "–ë–∞—Ç–∞—Ä–µ–π–∫–∏ 100", expected: "–¢–æ–≤–∞—Ä—ã –¥–ª—è –¥–æ–º–∞", amount: 100 },
  { input: "–°–∫–æ–≤–æ—Ä–æ–¥–∫–∞ 1500", expected: "–¢–æ–≤–∞—Ä—ã –¥–ª—è –¥–æ–º–∞", amount: 1500 },
  { input: "–õ–∞–º–ø–æ—á–∫–∏ 300", expected: "–¢–æ–≤–∞—Ä—ã –¥–ª—è –¥–æ–º–∞", amount: 300 },
  { input: "–°–µ–º–µ–Ω–∞ –∏ –≥—Ä—É–Ω—Ç 400", expected: "–¢–æ–≤–∞—Ä—ã –¥–ª—è –¥–æ–º–∞", amount: 400 },
  { input: "–î—Ä–æ–≤–∞ –¥–ª—è –¥–∞—á–∏ 2000", expected: "–¢–æ–≤–∞—Ä—ã –¥–ª—è –¥–æ–º–∞", amount: 2000 },
  { input: "–£–≥–æ–ª—å –∏ —Ä–æ–∑–∂–∏–≥ 500", expected: "–¢–æ–≤–∞—Ä—ã –¥–ª—è –¥–æ–º–∞", amount: 500 },
  { input: "–°—Ç—É–ª –∏–∫–µ–∞ 4500", expected: "–†–µ–º–æ–Ω—Ç –∏ –º–µ–±–µ–ª—å", amount: 4500 },
  { input: "–†–µ–º–æ–Ω—Ç –∫—Ä–∞–Ω–∞ 2000", expected: "–†–µ–º–æ–Ω—Ç –∏ –º–µ–±–µ–ª—å", amount: 2000 }, // –°–∞–Ω—Ç–µ—Ö–Ω–∏–∫
  { input: "–û–±–æ–∏ 3000", expected: "–†–µ–º–æ–Ω—Ç –∏ –º–µ–±–µ–ª—å", amount: 3000 },
  { input: "–ê—Ä–µ–Ω–¥–∞ –∫–≤–∞—Ä—Ç–∏—Ä—ã 45000", expected: "–ê—Ä–µ–Ω–¥–∞ –∂–∏–ª—å—è", amount: 45000 },
  { input: "–ö–æ–º–º—É–Ω–∞–ª–∫–∞ 5000", expected: "–ñ–ö–£ –∏ —Å—á–µ—Ç–∞", amount: 5000 },
  { input: "–°–≤–µ—Ç 1200", expected: "–ñ–ö–£ –∏ —Å—á–µ—Ç–∞", amount: 1200 },
  { input: "–í–æ–¥–∞ 800", expected: "–ñ–ö–£ –∏ —Å—á–µ—Ç–∞", amount: 800 },

  // --- –û–î–ï–ñ–î–ê –ò –£–•–û–î (–†–∞–∑–¥–µ–ª—è–µ–º!) ---
  { input: "–ö—Ä–æ—Å—Å–æ–≤–∫–∏ –Ω–∞–π–∫ 9000", expected: "–û–¥–µ–∂–¥–∞ –∏ –æ–±—É–≤—å", amount: 9000 },
  { input: "–î–∂–∏–Ω—Å—ã 3500", expected: "–û–¥–µ–∂–¥–∞ –∏ –æ–±—É–≤—å", amount: 3500 },
  { input: "–¢—Ä—É—Å—ã –∏ –Ω–æ—Å–∫–∏ 1000", expected: "–û–¥–µ–∂–¥–∞ –∏ –æ–±—É–≤—å", amount: 1000 },
  { input: "–ó–æ–Ω—Ç 500", expected: "–û–¥–µ–∂–¥–∞ –∏ –æ–±—É–≤—å", amount: 500 }, // –ê–∫—Å–µ—Å—Å—É–∞—Ä
  { input: "–†–µ–º–æ–Ω—Ç –æ–±—É–≤–∏ 400", expected: "–û–¥–µ–∂–¥–∞ –∏ –æ–±—É–≤—å", amount: 400 }, // –£—Å–ª—É–≥–∞ –¥–ª—è –æ–¥–µ–∂–¥—ã
  { input: "–•–∏–º—á–∏—Å—Ç–∫–∞ 1500", expected: "–û–¥–µ–∂–¥–∞ –∏ –æ–±—É–≤—å", amount: 1500 }, // –£—Å–ª—É–≥–∞ –¥–ª—è –æ–¥–µ–∂–¥—ã
  { input: "–ì—É–±–∫–∞ –¥–ª—è –æ–±—É–≤–∏ 100", expected: "–û–¥–µ–∂–¥–∞ –∏ –æ–±—É–≤—å", amount: 100 }, // –£—Ö–æ–¥ –∑–∞ –æ–¥–µ–∂–¥–æ–π
  { input: "–°—Ç—Ä–∏–∂–∫–∞ 1200", expected: "–ö—Ä–∞—Å–æ—Ç–∞ –∏ —É—Ö–æ–¥", amount: 1200 },
  { input: "–ú–∞–Ω–∏–∫—é—Ä 2000", expected: "–ö—Ä–∞—Å–æ—Ç–∞ –∏ —É—Ö–æ–¥", amount: 2000 },
  { input: "–®–∞–º–ø—É–Ω—å –∏ –º—ã–ª–æ 600", expected: "–ö—Ä–∞—Å–æ—Ç–∞ –∏ —É—Ö–æ–¥", amount: 600 },
  { input: "–ö—Ä–µ–º –¥–ª—è –ª–∏—Ü–∞ 3000", expected: "–ö—Ä–∞—Å–æ—Ç–∞ –∏ —É—Ö–æ–¥", amount: 3000 },

  // --- –¢–ï–•–ù–ò–ö–ê –ò –°–í–Ø–ó–¨ ---
  {
    input: "–ê–π—Ñ–æ–Ω 15 100000",
    expected: "–¢–µ—Ö–Ω–∏–∫–∞ –∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞",
    amount: 100000,
  },
  { input: "–ù–∞—É—à–Ω–∏–∫–∏ 15000", expected: "–¢–µ—Ö–Ω–∏–∫–∞ –∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞", amount: 15000 },
  {
    input: "–ó–∞—Ä—è–¥–∫–∞ type c 800",
    expected: "–¢–µ—Ö–Ω–∏–∫–∞ –∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞",
    amount: 800,
  },
  {
    input: "–†–µ–º–æ–Ω—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞ 3000",
    expected: "–¢–µ—Ö–Ω–∏–∫–∞ –∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞",
    amount: 3000,
  },
  { input: "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –º–≥—Ç—Å 650", expected: "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ —Å–≤—è–∑—å", amount: 650 },
  { input: "–ú–µ–≥–∞—Ñ–æ–Ω –±–∞–ª–∞–Ω—Å 500", expected: "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ —Å–≤—è–∑—å", amount: 500 },
  { input: "–û–ø–ª–∞—Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ 300", expected: "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ —Å–≤—è–∑—å", amount: 300 },

  // --- –£–°–õ–£–ì–ò, –ü–û–î–ü–ò–°–ö–ò, –ú–ï–î–ò–¶–ò–ù–ê ---
  { input: "–Ø–Ω–¥–µ–∫—Å –ø–ª—é—Å 299", expected: "–ü–æ–¥–ø–∏—Å–∫–∏ –∏ —Å–µ—Ä–≤–∏—Å—ã", amount: 299 },
  { input: "Netflix 12 eur", expected: "–ü–æ–¥–ø–∏—Å–∫–∏ –∏ —Å–µ—Ä–≤–∏—Å—ã", amount: 12 },
  { input: "VPN 450", expected: "–ü–æ–¥–ø–∏—Å–∫–∏ –∏ —Å–µ—Ä–≤–∏—Å—ã", amount: 450 },
  { input: "–ù–æ—Ç–∞—Ä–∏—É—Å 2000", expected: "–ü–æ–¥–ø–∏—Å–∫–∏ –∏ —Å–µ—Ä–≤–∏—Å—ã", amount: 2000 },
  { input: "–ê–¥–≤–æ–∫–∞—Ç 5000", expected: "–ü–æ–¥–ø–∏—Å–∫–∏ –∏ —Å–µ—Ä–≤–∏—Å—ã", amount: 5000 },
  { input: "–ö—Å–µ—Ä–æ–∫–æ–ø–∏—è 50", expected: "–ü–æ–¥–ø–∏—Å–∫–∏ –∏ —Å–µ—Ä–≤–∏—Å—ã", amount: 50 },
  { input: "–§–æ—Ç–æ –Ω–∞ –ø–∞—Å–ø–æ—Ä—Ç 350", expected: "–ü–æ–¥–ø–∏—Å–∫–∏ –∏ —Å–µ—Ä–≤–∏—Å—ã", amount: 350 },
  {
    input: "–ê–ø—Ç–µ–∫–∞ –∞—Å–ø–∏—Ä–∏–Ω 500",
    expected: "–ú–µ–¥–∏—Ü–∏–Ω–∞ –∏ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞",
    amount: 500,
  },
  {
    input: "–í—Ä–∞—á —Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥ 5000",
    expected: "–ú–µ–¥–∏—Ü–∏–Ω–∞ –∏ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞",
    amount: 5000,
  },
  { input: "–ê–Ω–∞–ª–∏–∑—ã 3000", expected: "–ú–µ–¥–∏—Ü–∏–Ω–∞ –∏ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞", amount: 3000 },
  { input: "–ü—Å–∏—Ö–æ–ª–æ–≥ 3000", expected: "–ú–µ–¥–∏—Ü–∏–Ω–∞ –∏ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞", amount: 3000 },
  { input: "–õ–∏–Ω–∑—ã 2000", expected: "–ú–µ–¥–∏—Ü–∏–Ω–∞ –∏ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞", amount: 2000 },

  // --- –î–û–°–£–ì –ò –°–ü–û–†–¢ (–†–∞–∑–¥–µ–ª—è–µ–º!) ---
  { input: "–ö–∏–Ω–æ –±–∏–ª–µ—Ç—ã 900", expected: "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", amount: 900 },
  { input: "–ë–æ—É–ª–∏–Ω–≥ 2000", expected: "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", amount: 2000 },
  { input: "–ö–∞—Ç–æ–∫ 400", expected: "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", amount: 400 },
  { input: "–ú—É–∑–µ–π 800", expected: "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", amount: 800 },
  { input: "–°–∞—É–Ω–∞ 1500", expected: "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", amount: 1500 }, // –î–æ—Å—É–≥
  { input: "–ò–≥—Ä–∞ –≤ Steam 1500", expected: "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", amount: 1500 },
  { input: "–£–¥–æ—á–∫–∞ 2000", expected: "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", amount: 2000 },
  { input: "–§–∏—Ç–Ω–µ—Å 25000", expected: "–°–ø–æ—Ä—Ç", amount: 25000 },
  { input: "–ë–∞—Å—Å–µ–π–Ω 500", expected: "–°–ø–æ—Ä—Ç", amount: 500 },
  { input: "–¢—Ä–µ–Ω–µ—Ä 1500", expected: "–°–ø–æ—Ä—Ç", amount: 1500 },
  { input: "–í–µ–ª–∏–∫ —Ä–µ–º–æ–Ω—Ç 1500", expected: "–°–ø–æ—Ä—Ç", amount: 1500 }, // –°–ø–æ—Ä—Ç–∏–Ω–≤–µ–Ω—Ç–∞—Ä—å

  // --- –î–ï–¢–ò, –ü–ò–¢–û–ú–¶–´, –ü–û–î–ê–†–ö–ò ---
  { input: "–ü–∞–º–ø–µ—Ä—Å—ã 1500", expected: "–î–µ—Ç–∏", amount: 1500 },
  { input: "–°–∞–¥–∏–∫ 4500", expected: "–î–µ—Ç–∏", amount: 4500 },
  { input: "–ò–≥—Ä—É—à–∫–∞ —Å—ã–Ω—É 800", expected: "–î–µ—Ç–∏", amount: 800 },
  { input: "–®–∫–æ–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞ 3000", expected: "–î–µ—Ç–∏", amount: 3000 }, // –•–æ—Ç—å –∏ –æ–¥–µ–∂–¥–∞, –Ω–æ –¥–µ—Ç—Å–∫–∞—è -> –î–µ—Ç–∏
  { input: "–ö–æ—Ä–º –≤–∏—Å–∫–∞—Å 200", expected: "–ü–∏—Ç–æ–º—Ü—ã", amount: 200 },
  { input: "–í–µ—Ç–∫–ª–∏–Ω–∏–∫–∞ 1200", expected: "–ü–∏—Ç–æ–º—Ü—ã", amount: 1200 },
  { input: "–ù–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å 450", expected: "–ü–∏—Ç–æ–º—Ü—ã", amount: 450 },
  { input: "–ò–≥—Ä—É—à–∫–∞ —Å–æ–±–∞–∫–µ 350", expected: "–ü–∏—Ç–æ–º—Ü—ã", amount: 350 },
  { input: "–ü–æ–¥–∞—Ä–æ–∫ –º–∞–º–µ 3000", expected: "–ü–æ–¥–∞—Ä–∫–∏", amount: 3000 },
  { input: "–¶–≤–µ—Ç—ã 1500", expected: "–ü–æ–¥–∞—Ä–∫–∏", amount: 1500 },
  { input: "–õ–µ–≥–æ –ø–ª–µ–º—è–Ω–Ω–∏–∫—É 5000", expected: "–ü–æ–¥–∞—Ä–∫–∏", amount: 5000 },
  {
    input: "–§–æ–Ω–¥ –•–∞–±–µ–Ω—Å–∫–æ–≥–æ 500",
    expected: "–ë–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
    amount: 500,
  },
  { input: "–ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ 100", expected: "–ë–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å", amount: 100 },

  // --- –ü–£–¢–ï–®–ï–°–¢–í–ò–Ø ---
  { input: "–û—Ç–µ–ª—å –°–æ—á–∏ 18000", expected: "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ –æ—Ç–µ–ª–∏", amount: 18000 },
  {
    input: "–ë–∏–ª–µ—Ç—ã –Ω–∞ —Å–∞–º–æ–ª–µ—Ç 25000",
    expected: "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ –æ—Ç–µ–ª–∏",
    amount: 25000,
  },
  {
    input: "–¢—É—Ä—Ü–∏—è —Ç—É—Ä 100000",
    expected: "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ –æ—Ç–µ–ª–∏",
    amount: 100000,
  },
  {
    input: "–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –≤ –ø–æ–µ–∑–¥–∫—É 1500",
    expected: "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ –æ—Ç–µ–ª–∏",
    amount: 1500,
  }, // –°–ø–µ—Ü–∏—Ñ–∏–∫–∞
  { input: "–ü–∞–ª–∞—Ç–∫–∞ 5000", expected: "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ –æ—Ç–µ–ª–∏", amount: 5000 },
  { input: "–°–ø–∞–ª—å–Ω–∏–∫ 2000", expected: "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ –æ—Ç–µ–ª–∏", amount: 2000 },
  { input: "–ß–µ–º–æ–¥–∞–Ω 4000", expected: "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ –æ—Ç–µ–ª–∏", amount: 4000 },
  {
    input: "–†—é–∫–∑–∞–∫ —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π 3000",
    expected: "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ –æ—Ç–µ–ª–∏",
    amount: 3000,
  },

  // --- –§–ò–ù–ê–ù–°–´ –ò –ü–†–ò–û–†–ò–¢–ï–¢–´ ---
  { input: "–ö—Ä–µ–¥–∏—Ç 15000", expected: "–ö—Ä–µ–¥–∏—Ç—ã –∏ –¥–æ–ª–≥–∏", amount: 15000 },
  { input: "–î–æ–ª–≥ –¥—Ä—É–≥—É 5000", expected: "–ö—Ä–µ–¥–∏—Ç—ã –∏ –¥–æ–ª–≥–∏", amount: 5000 },
  {
    input: "–ü–æ–≥–∞—Å–∏–ª –∫—Ä–µ–¥–∏—Ç–∫—É 20000",
    expected: "–ö—Ä–µ–¥–∏—Ç—ã –∏ –¥–æ–ª–≥–∏",
    amount: 20000,
  },
  {
    input: "–ù–∞–ª–æ–≥ –Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É 4500",
    expected: "–ù–∞–ª–æ–≥–∏ –∏ —à—Ç—Ä–∞—Ñ—ã",
    amount: 4500,
  },
  { input: "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ 10000", expected: "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏", amount: 10000 },
  { input: "–û–±–º–µ–Ω –≤–∞–ª—é—Ç—ã 1000 usd", expected: "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏", amount: 1000 }, // –í–∞–ª—é—Ç–∞
  { input: "–ê–∫—Ü–∏–∏ –ì–∞–∑–ø—Ä–æ–º 5000", expected: "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏", amount: 5000 },

  // –ü–†–ò–û–†–ò–¢–ï–¢–´ (–°–º–µ—à–∞–Ω–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏)
  { input: "–í–∏–Ω–æ 1200 –∏ —Å—ã—Ä 500", expected: "–ê–ª–∫–æ–≥–æ–ª—å –∏ —Ç–∞–±–∞–∫", amount: 1700 }, // –°—É–º–º–∞!
  { input: "–ü–∏–≤–æ –∏ —á–∏–ø—Å—ã 500", expected: "–ê–ª–∫–æ–≥–æ–ª—å –∏ —Ç–∞–±–∞–∫", amount: 500 },
  {
    input: "–°–∏–≥–∞—Ä–µ—Ç—ã –∏ –∑–∞–∂–∏–≥–∞–ª–∫–∞ 300",
    expected: "–ê–ª–∫–æ–≥–æ–ª—å –∏ —Ç–∞–±–∞–∫",
    amount: 300,
  },
  { input: "–°—Ç–∏–∫–∏ 200", expected: "–ê–ª–∫–æ–≥–æ–ª—å –∏ —Ç–∞–±–∞–∫", amount: 200 },

  // --- –¢–ï–°–¢–´ –ù–ê –ü–ê–†–°–ò–ù–ì –°–£–ú–ú–´ ---
  { input: "–¢–∞–∫—Å–∏ 500—Ä", expected: "–¢–∞–∫—Å–∏/–ö–∞—Ä—à–µ—Ä–∏–Ω–≥", amount: 500 },
  { input: "–¢–∞–∫—Å–∏ 500 RUR", expected: "–¢–∞–∫—Å–∏/–ö–∞—Ä—à–µ—Ä–∏–Ω–≥", amount: 500 },
  { input: "–¢–∞–∫—Å–∏ 1.5–∫", expected: "–¢–∞–∫—Å–∏/–ö–∞—Ä—à–µ—Ä–∏–Ω–≥", amount: 1500 },
  { input: "–¢–∞–∫—Å–∏ 2,500", expected: "–¢–∞–∫—Å–∏/–ö–∞—Ä—à–µ—Ä–∏–Ω–≥", amount: 2500 },
  { input: "–ö–æ—Ñ–µ 150.50", expected: "–ö–∞—Ñ–µ –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã", amount: 150.5 },

  // --- FILLERS (–î–æ–±–∏–≤–∫–∞ –¥–æ 150) ---
  { input: "–ö–µ—Ñ–∏—Ä 80", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 80 },
  { input: "–ë–∞—Ç–æ–Ω 50", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 50 },
  { input: "–°–Ω–∏–∫–µ—Ä—Å 60", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 60 },
  { input: "–í–æ–¥–∞ 30", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 30 },
  { input: "–ñ–≤–∞—á–∫–∞ 40", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 40 },
  { input: "–°–æ–ª—å 20", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 20 },
  { input: "–°–∞—Ö–∞—Ä 70", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 70 },
  { input: "–ú—É–∫–∞ 100", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 100 },
  { input: "–Ø–π—Ü–∞ 120", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 120 },
  { input: "–ú–∞—Å–ª–æ 180", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 180 },
  { input: "–¢–≤–æ—Ä–æ–≥ 90", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 90 },
  { input: "–°–º–µ—Ç–∞–Ω–∞ 80", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 80 },
  { input: "–ô–æ–≥—É—Ä—Ç 50", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 50 },
  { input: "–°—ã—Ä 200", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 200 },
  { input: "–ö–æ–ª–±–∞—Å–∞ 300", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 300 },
  { input: "–°–æ—Å–∏—Å–∫–∏ 250", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 250 },
  { input: "–ü–µ–ª—å–º–µ–Ω–∏ 400", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 400 },
  { input: "–ú–∞–∫–∞—Ä–æ–Ω—ã 80", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 80 },
  { input: "–†–∏—Å 100", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 100 },
  { input: "–ì—Ä–µ—á–∫–∞ 90", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 90 },
  { input: "–ß–∞–π 150", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 150 },
  { input: "–ö–æ—Ñ–µ –≤ –∑–µ—Ä–Ω–∞—Ö 800", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 800 },
  { input: "–ü–µ—á–µ–Ω—å–µ 100", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 100 },
  { input: "–ö–æ–Ω—Ñ–µ—Ç—ã 200", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 200 },
  { input: "–¢–æ—Ä—Ç 500", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 500 },
  { input: "–ü–∏—Ä–æ–∂–Ω–æ–µ 150", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 150 },
  { input: "–°–æ–∫ 120", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 120 },
  { input: "–ì–∞–∑–∏—Ä–æ–≤–∫–∞ 80", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 80 },
  { input: "–ß–∏–ø—Å—ã 100", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 100 }, // –ï—Å–ª–∏ –±–µ–∑ –ø–∏–≤–∞ -> –ü—Ä–æ–¥—É–∫—Ç—ã
  { input: "–°—É—Ö–∞—Ä–∏–∫–∏ 50", expected: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 50 }, // –ï—Å–ª–∏ –±–µ–∑ –ø–∏–≤–∞ -> –ü—Ä–æ–¥—É–∫—Ç—ã
];

// ... (–û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –∑–∞–ø—É—Å–∫–∞ test-runner –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
const CONCURRENCY_LIMIT = 5;
const OUTPUT_FILE = "test_report_final.json";

interface TestResult {
  input: string;
  expectedCategory: string;
  actualCategory: string | null;
  expectedAmount: number;
  actualAmount: number | null;
  successCategory: boolean;
  successAmount: boolean;
  error?: string;
}

async function runTests() {
  const limit = pLimit(CONCURRENCY_LIMIT);
  const progressBar = new cliProgress.SingleBar(
    {},
    cliProgress.Presets.shades_classic
  );
  const results: TestResult[] = [];

  console.log(`üöÄ –ó–∞–ø—É—Å–∫ ${TEST_CASES.length} —Ç–µ—Å—Ç–æ–≤...`);
  progressBar.start(TEST_CASES.length, 0);

  const tasks = TEST_CASES.map((testCase) => {
    return limit(async () => {
      let actualCategory = null;
      let actualAmount = null;
      let errorMsg = undefined;

      try {
        const result = await LLMCategorizeExpense(testCase.input);

        if (result) {
          actualCategory = result.category;
          actualAmount = result.amount;
        } else {
          errorMsg = "Empty/Invalid response";
        }
      } catch (e: any) {
        errorMsg = e.message;
      }

      const successCategory = actualCategory === testCase.expected;
      const successAmount =
        actualAmount !== null &&
        Math.abs(actualAmount - testCase.amount) < 0.01;

      results.push({
        input: testCase.input,
        expectedCategory: testCase.expected,
        actualCategory: actualCategory,
        expectedAmount: testCase.amount,
        actualAmount: actualAmount,
        successCategory,
        successAmount,
        error: errorMsg,
      });

      progressBar.increment();
    });
  });

  await Promise.all(tasks);
  progressBar.stop();

  const failedCategory = results.filter((r) => !r.successCategory);
  const failedAmount = results.filter((r) => !r.successAmount);
  const totalSuccess = results.filter(
    (r) => r.successCategory && r.successAmount
  ).length;

  console.log(`\nüìä –ò–¢–û–ì–ò:`);
  console.log(`‚úÖ –ò–¥–µ–∞–ª—å–Ω–æ: ${totalSuccess} / ${results.length}`);
  console.log(`‚ùå –û—à–∏–±–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π: ${failedCategory.length}`);
  console.log(`‚ùå –û—à–∏–±–∫–∏ —Å—É–º–º: ${failedAmount.length}`);
  console.log(
    `üéØ –¢–æ—á–Ω–æ—Å—Ç—å: ${((totalSuccess / results.length) * 100).toFixed(1)}%`
  );

  if (failedCategory.length > 0 || failedAmount.length > 0) {
    fs.writeFileSync(
      OUTPUT_FILE,
      JSON.stringify({ failedCategory, failedAmount }, null, 2)
    );
    console.log(`\n‚ö†Ô∏è –û—à–∏–±–∫–∏ –≤ ${OUTPUT_FILE}`);
  }
}

runTests();
